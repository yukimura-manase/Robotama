
< Apacheの設定関連のメモ🔥 >


[ 1.Apache のバージョン確認 Ver. Windows10 ]


1. コマンドプロンプトからインストールした apache のフォルダへ移動

　　cd c:\apache

2. 「bin」フォルダへ移動

　　cd bin

3. 以下のコマンドを実行

　　httpd -v

Apache24\bin>httpd -v
Server version: Apache/2.4.54 (Win64)
Apache Lounge VS16 Server built:   Jun 22 2022 09:58:15


Windows環境でApacheのバージョンを確認する方法
http://www.dojeun.com/contentsview.php?listid=00144



--------------------------------------------------------------------------------------------------------------------------------------

[ Apacheのhttpd.confを書き換えた後の再起動🔥 httpd.conf を書き換えたのに反映されない場合の対処法🔥 ]


    cd C:\httpd-2.4.54-win64-VS16\Apache24\bin

    1. httpd.exe を削除する🔥

        httpd.exe -k uninstall

        C:\CGGS\httpd-2.4.54-win64-VS16\Apache24\bin>httpd.exe -k uninstall

        Removing the 'Apache2.4' service
        The 'Apache2.4' service has been removed successfully.

    2. httpd.ext を再インストールする🔥

        httpd -k install

        C:\CGGS\httpd-2.4.54-win64-VS16\Apache24\bin>httpd -k install
        Installing the 'Apache2.4' service
        The 'Apache2.4' service is successfully installed.
        Testing httpd.conf....
        Errors reported here must be corrected before the service can be started.


        Installの時に「 httpd.conf 」を読み込んでくれる。

            Testing httpd.conf....
            Errors reported here must be corrected before the service can be started.

            httpd.conf をテストしています....
            ここで報告されたエラーは、サービスを開始する前に修正する必要があります。


    3. httpd.exe を起動する🔥

        httpd -k start

        C:\CGGS\httpd-2.4.54-win64-VS16\Apache24\bin>httpd -k start

        C:\CGGS\httpd-2.4.54-win64-VS16\Apache24\bin>




--------------------------------------------------------------------------------------------------------------------------------------

[ 2. Apache httpd.conf(設定ファイル)の見方 ]

    Linux でも Windows でも Apache の設定ファイルは httpd.conf ファイルです。



--------------------------------------------------------------------------------------------------------------------------------------

[ 2. 任意のディレクトリをドキュメントルートにする ]


ドキュメントルート とは、サイトのルート / になるディレクトリの事。

多くのディストリビューションでは /var/www/html になっている。

htdocs や public_html の場合もある。

デフォルトは / 以下をアクセス不可にしてある。


    [ httpd.conf ]

        <Directory />
            AllowOverride none
            Require all denied
        </Directory>


例えば、/var/www/localhost をドキュメントルートにしたい場合は、以下のようにアクセス許可を追加する。

    [ httpd.conf ]

        <Directory "/var/www/localhost">
            Options Indexes FollowSymLinks
            AllowOverride All
            Require all granted
        </Directory>



Apacheの設定
https://qiita.com/TomoakiNagahara/items/ba4e78f5ada7b18da7f1

--------------------------------------------------------------------------------------------------------------------------------------

[ 3. Apache 2.4 ディレクトリ一覧を表示させない ]

    Apacheサーバーでディレクトリを非表示にする

    Apacheサーバーでは、「index.html」の等の「 DirectoryIndex」で指定したファイルがない場合に、下記のようにディレクトリ一覧が表示される場合があります






Apache 2.4 ディレクトリ一覧を表示させない
https://ex1.m-yabe.com/archives/4915


--------------------------------------------------------------------------------------------------------------------------------------

[ Redirectの設定 ]


mod_rewriteが使用可能かを確認
/etc/httpd/conf/httpd.conf内の以下の行が存在し、コメントアウトされていないことを確認。

LoadModule rewrite_module modules/mod_rewrite.so

もし設定を修正した場合は以下のコマンドで、確認・反映

apachectl configtest

/etc/init.d/httpd graceful

gracefulはリクエスト処理を中断しないで反映する。
httpd reloadでも反映可能。こちらは、リクエスト処理を中断して、反映する。




1. httpd.confにおけるリダイレクト設定
https://tamata78.hatenablog.com/entry/2018/11/20/205222



2. Redirectディレクティブ：特定のパスへのリクエストに対してリダイレクトする
https://www.javadrive.jp/apache/ini/index15.html



--------------------------------------------------------------------------------------------------------------------------------------

[ VirtualHost🔥 ]


バーチャルホストという用語は、1 台のマシン上で (company1.com と company2.com のような) 二つ以上のウェブサイトを扱う運用方法のことを指します。
Apache バーチャルホスト説明書


example.comとかexample.netのドメインを複数運用してたとして、それぞれのドメインを別サーバーで設定するのは簡単。

でも両方アクセスが少ないとサーバーを新規に構築するコストと見合わないですよね？

そこでVirtualHostの出番。

1台のサーバーにインストールしたApacheを使って複数のドメインでサービスを行おうってことが出来る。



0. DocumentRoot

    /var/www/にsample_host_htmlを作ったとしておく

    作成したフォルダの所有者を apache ユーザーに変更をしておくこと。

   
    DocumentRoot

        => クライアントからのアクセスを許可するディレクトリ、つまりブラウザから直接アクセス可能なファイルを設置する場所。


1. VirtualHostの設定を作成


※ホスト名はsample.host.jpに設定してあるとする

/etc/httpd/conf.d
touch sample.host.jp.conf
ファイル名はなんでもいいらしいがホスト名と合わせた方がいい。
拡張子に.confをつける必要がある

最低限の設定

sample.host.jp.conf


<VirtualHost *:80>
  DocumentRoot /var/www/sample_host_html
  ServerName sample.host.jp
</VirtualHost>


Apache再起動、サイトが見えるか確認。終わり。



ApacheのVirtualHostってなんだ
https://qiita.com/monaky/items/b5f589e59ee002a1d355




【Apache】VirtualHostを使ってみよう
https://qiita.com/erik_t/items/63f079826a60aaa642d3







<VirtualHost 192.168.10.104:80>
  ServerName    www.example.com
  ServerAdmin   admin@example.com
  DocumentRoot  d:/pg/Apache/Apache24/htdocs_com
</VirtualHost>

<VirtualHost 192.168.10.105:80>
  ServerName    www.example.jp
  ServerAdmin   admin@example.jp
  DocumentRoot  d:/pg/Apache/Apache24/htdocs_jp
</VirtualHost>




Listen 192.168.10.104:80
Listen 192.168.10.105:80

<Directory "${SRVROOT}/htdocs_com">
  Require all granted
</Directory>

<Directory "${SRVROOT}/htdocs_jp">
  Require all granted
</Directory>




--------------------------------------------------------------------------------------------------------------------------------------



[ New-Task🔥 ]

1. ダッシュボードに特定の IP のみにアクセス許可するよう設定

        https://macareux.co.jp/blog/concrete5-access-restriction

    を参考に、ダッシュボードに特定の IP のみにアクセス許可するよう設定してほしいです。

    ・上記とは違ってloginには制限かけない

    ・IPアドレスは210.148.222.145


2. httpd.confに以下を追加してみてください。(要Apache再起動)

  
### TimeOut-Config ###
Timeout 300
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 15


http://park12.wakwak.com/~eslab/pcmemo/linux/apache/apache3.html

https://teratail.com/questions/321787




3. 脆弱性検査でわかった脆弱性の対応もお願いします。


httpd.conf のOptionsにて以下のように設定するとexecを除き、SSIを使用することができる．

    Options +IncludeNOEXEC



SSI対応
https://news-nknskn.hatenablog.com/entry/2017/02/01/053630




