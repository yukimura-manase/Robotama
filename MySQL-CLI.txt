
< MySQL コマンド集🔥 >


< 2022/09/05 Today's Task🔥 >

本番環境は、他のCMSサイトにも使用する予定があるので、以下のようにしてください。

    MariaDB root パスワード変更 Robotama => Clear🔥

    MariaDB Robotama ユーザー作成 パスワード Robotama => Clear🔥

    データベース名は Robotama に変更、 Robotama ユーザーに権限設定 => Clear🔥

    Apacheも Robotama ディレクトリに移動


concretecmsのデータベース設定は application/config/database.php

データベース名の変更は新規に作成してdumpファイルから新規に作成したほうがいいかも => Clear🔥



よく使うMySQLコマンド&構文集
https://qiita.com/CyberMergina/items/f889519e6be19c46f5f4#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E4%B8%80%E8%A6%A7%E3%81%AE%E8%A1%A8%E7%A4%BA



< User情報を取得する🔥 >

1. User情報を取得する🔥

MariaDB [(none)]> select user from mysql.user;
+-------------+
| User        |
+-------------+
| root        |
| root        |
| root        |
| mariadb.sys |
| root        |
+-------------+
5 rows in set (0.001 sec)


2. User情報とHost情報を取得する🔥

MariaDB [(none)]> select user, host from mysql.user;
+-------------+-----------+
| User        | Host      |
+-------------+-----------+
| root        | 127.0.0.1 |
| root        | ::1       |
| root        | jcgcms-a  |
| mariadb.sys | localhost |
| root        | localhost |
+-------------+-----------+
5 rows in set (0.001 sec)



3. Userのパスワードを変更する🔥


    # パスワード変更方法-1
    SET PASSWORD FOR ユーザ名@ホスト名=password('新しいパスワード');

        => 文字列として渡す


    # 現在接続しているユーザーに新しいパスワードを設定する場合
    set password = password('Robotama');


    # パスワード変更方法-2
    mysqladmin password 新しいパスワード -u ユーザー名 -p

        => パスワードをクオーテーションで囲む必要はない！


    MySQLでパスワードを変更する「SET PASSWORD」
    https://uxmilk.jp/12396


4. 新しいUserを作成する🔥

    新しくユーザを作成するためには、CREATE USER文を使用します。

        CREATE USER 'ユーザ名'@'ホスト名' IDENTIFIED BY 'パスワード';

    ユーザ名、パスワードには、任意の文字列を設定して下さい。ホスト名には、MySQLへ接続するホストを指定して下さい。ホスト名の代わりにIPアドレスやlocalhostを指定することも可能です。


    ひとまず、User名&Passwordだけ設定する

    CREATE USER Robotama IDENTIFIED BY 'Robotama';

    create user 'Robotama'@'localhost' IDENTIFIED BY 'Robotama';



    MySQLでユーザを作成し、権限を設定する方法
    https://proengineer.internous.co.jp/content/columnfeature/6638#:~:text=%E6%96%B0%E3%81%97%E3%81%8F%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B,%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E4%B8%8B%E3%81%95%E3%81%84%E3%80%82



4-1. User を削除する🔥
    
    DROP USER CGGS;

    drop user 'CGGS'@'localhost';


5.  ユーザーへの権限付与🔥

    5-1. 権限の確認
        
        show grants for CGGS;

        show grants for 'ユーザー名'@'ホスト名';

        show grants for 'CGGS'@'localhost';

    5-2. 権限の付与
    
        GRANT 権限 ON データベース名.テーブル名 TO 'ユーザー名';

        grant all on CGGS.* to CGGS;

        grant all on CGGS.* to 'CGGS'@'localhost';


        GRANT ALL PRIVILEGES ON * . * TO 'CGGS'@'localhost';


    5-3. 権限を付与した後のReload

    FLUSH PRIVILEGES;


    MySQLで新しいユーザーを作成して権限を付与する方法
    https://www.digitalocean.com/community/tutorials/how-to-create-a-new-user-and-grant-permissions-in-mysql-ja


【MySQL入門】ユーザー作成の方法を解説！8.0からの変更点も紹介
https://www.sejuku.net/blog/82303




6. DatabaseのDumpファイルを取る => Dumpは、外部から取れる🔥

    mysqldump -u [ユーザー名] -p -x test_db > [出力ファイル名]


    # MariaDBからdumpファイルを生成する！
    mysqldump -u root -p managementdb > managementdb.dump



    mysqldump -u root -p cggs_maria > C:\cggs_maria.dump




    # Dumpファイルを取る🔥
    mysqldump -u root -p concrete8 > cggs.dump

    # Restoreする🔥
    mysql -u root -p CGGS < C:\COAST_GUARD_GLOBAL_SUMMIT.sql


mysql -u root -p maria_cggs < C:\COAST_GUARD_GLOBAL_SUMMIT.sql


mysqladmin password FwXjueuzNSqc3hoensC2 -u CGGS -p

mysqldump -u root -p CGGS > C:\cggs.dump


7. MySQL にDataBase名指定でログインする🔥

    mysql -u CGGS -p CGGS




< 本番環境のPassWord関連 >


    MariaDB root パスワード: Robotama

    MariaDB CGGS ユーザー・パスワード: Robotama

        => *6E6FEC51E20F3B7066FAD309632695A2072EC805

    データベース名は CGGS に変更、 CGGS ユーザーに権限設定 

    Apacheも CGGS ディレクトリに移動





8. MySQLで新しいユーザーを作成して権限を付与する方法


CREATE USER 'CGGS'@'127.0.0.1' IDENTIFIED BY 'Robotama';

CREATE USER CGGS@localhost IDENTIFIED BY 'Robotama';

MariaDB [(none)]> CREATE USER CGGS@127.0.0.1 IDENTIFIED BY 'Robotama';
Query OK, 0 rows affected (0.005 sec)





GRANT ALL PRIVILEGES ON * . * TO CGGS@127.0.0.1;

GRANT ALL PRIVILEGES ON * . * TO CGGS@localhost;


FLUSH PRIVILEGES;



MySQLで新しいユーザーを作成して権限を付与する方法
https://www.digitalocean.com/community/tutorials/how-to-create-a-new-user-and-grant-permissions-in-mysql-ja




# userName, Host, Password の確認

MariaDB [(none)]> select user, host, password from mysql.user;
+-------------+-----------+-------------------------------------------+
| User        | Host      | Password                                  |
+-------------+-----------+-------------------------------------------+
| mariadb.sys | localhost |                                           |
| root        | localhost | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |
| root        | jcgcms-a  | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |
| root        | 127.0.0.1 | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |
| root        | ::1       | *9E1AA81F840662856BA1AFA79A5DB9B99140499C |
+-------------+-----------+-------------------------------------------+
5 rows in set (0.001 sec)




# Host指定で、接続先を指定する🔥
mysql -u CGGS -p -h 127.0.0.1

mysql -u CGGS -p -h localhost





MariaDBのポートを確認する
MariaDBが接続するときに使うポート番号を確認します。
デフォルトのままであれば、3306ですので、飛ばしても構いません

mysql > show variables like 'port'

+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| port          | 3306  |
+---------------+-------+




【MariaDB/MySQL】外部接続の設定方法
https://blog.websandbag.com/entry/2018/06/03/223431


--------------------------------------------------------------------------------------------------------------------------------------

MariaDB [(none)]> create database cggs_maria;
Query OK, 1 row affected (0.001 sec)

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| cggs               |
| cggs_maria         |
| concrete8          |
| concrete859        |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
8 rows in set (0.001 sec)

MariaDB [(none)]> exit;
Bye



# Restoreする🔥

C:\Users\JCGCMS-AAdmin>mysql -u root -p cggs_maria < C:\Robotama.sql

Enter password: ********************






< 参考・引用🔥 >


よく使うMySQLコマンド&構文集
https://qiita.com/CyberMergina/items/f889519e6be19c46f5f4#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E4%B8%80%E8%A6%A7%E3%81%AE%E8%A1%A8%E7%A4%BA







